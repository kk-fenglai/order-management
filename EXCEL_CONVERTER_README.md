# Excel格式转换功能

## 功能概述

Excel格式转换功能可以将原始订单数据转换为海关申报格式，方便进行海关申报和清关操作。

## 功能特点

- 🔄 **自动格式转换**: 将原始订单格式转换为海关申报格式
- 📦 **快递单号提取**: 自动从货物1-10列中提取快递单号
- 📋 **模板化输出**: 生成符合海关申报要求的标准化格式
- 📊 **数据预览**: 转换后可以预览前10条记录
- 💾 **文件下载**: 支持下载转换后的Excel文件

## 使用方法

### 1. 访问功能页面
在系统导航栏中点击"Excel转换"链接，或直接访问 `/excel_converter` 页面。

### 2. 上传Excel文件
- 点击"选择Excel文件"按钮
- 选择包含以下列的Excel文件：
  - 姓名+拼音
  - 国手机号
  - 邮箱
  - 货物1 到 货物10（包含快递单号信息，客户可能只填写部分列）

### 3. 开始转换
- 点击"开始转换"按钮
- 系统会自动处理文件并显示转换结果

### 4. 下载结果
- 转换成功后，点击"下载转换后的Excel文件"按钮
- 文件将自动下载到本地

## 转换规则

### 输入格式（原始数据）
| 字段名 | 说明 | 示例 |
|--------|------|------|
| 姓名+拼音 | 客户姓名 | mia, 张三 (Zhang San) |
| 国手机号 | 手机号码 | 065186538, +33600000 |
| 邮箱 | 邮箱地址 | komeizakaya@gmail.com |
| 货物1-10 | 快递单号信息 | 快递单号:快递单号:SF1234567890 |

### 输出格式（转换后）
| 字段名 | 说明 | 默认值 |
|--------|------|--------|
| 客户姓名 | 客户姓名 | 从原始数据提取 |
| 快递单号 | 快递单号 | 从货物列提取 |
| 中文品名 (必填) | 产品中文名称 | 待填写 |
| 英文品名 (必填) | 产品英文名称 | To be filled |
| 材质 (中英文填写) (必填) | 产品材质 | 待填写 |
| 用途 (中英文填写) (必填) | 产品用途 | 待填写 |
| 国外海关编码 (必填) | 海关编码 | 待填写 |
| 产品类型/属性 (必填) | 产品类型 | 待填写 |
| 单位 套/包/组/个 (必填) | 计量单位 | 个 |
| 单箱产品数量 | 每箱数量 | 1 |
| 箱数/件数 CTN (必填为1) | 箱数 | 1 |
| 申报单价币种 | 货币类型 | EUR |
| 单个产品申报单价 | 单价 | 0.00 |
| 单个产品净重KG | 净重 | 0.00 |
| 产品高清图片 | 产品图片 | 空 |
| 品牌 | 品牌信息 | 空 |
| 品牌类型 | 品牌类型 | 空 |
| 型号 | 产品型号 | 空 |
| 销售链接 | 销售链接 | 空 |
| 备注 | 备注信息 | 包含原始数据信息 |
| 总产品数量 | 总数量 | 1 |
| 总申报金额 | 总金额 | 0.00 |

## 注意事项

1. **文件格式**: 只支持 `.xlsx` 格式的Excel文件
2. **必填字段**: 转换后的必填字段会标记为"待填写"，需要手动完善
3. **快递单号**: 系统会自动从"货物1"到"货物10"列中提取快递单号，支持部分填写
4. **数据完整性**: 建议在转换后检查并完善所有必填字段
5. **文件大小**: 建议上传文件大小不超过10MB
6. **灵活填写**: 客户可以在货物1-10列中任意填写快递单号，不要求全部填写

## 技术实现

- **后端**: Python Flask + Pandas + OpenPyXL
- **前端**: Bootstrap 5 + Font Awesome
- **文件处理**: 支持大文件处理，使用流式处理避免内存溢出
- **错误处理**: 完善的错误提示和异常处理机制

## 常见问题

### Q: 为什么转换后有些字段显示"待填写"？
A: 这些是海关申报的必填字段，需要根据实际产品信息手动填写。

### Q: 如何处理多个快递单号？
A: 系统会自动为每个快递单号创建一行记录，方便分别处理。客户可以在货物1-10列中任意填写快递单号，不要求全部填写。

### Q: 如果客户只填写了一个快递单号怎么办？
A: 系统会正确处理这种情况，只为填写的快递单号创建记录，空白的货物列会被忽略。

### Q: 转换失败怎么办？
A: 请检查Excel文件格式是否正确，确保包含必要的列名。

### Q: 为什么有些快递单号显示"找不到正确的快递单号"？
A: 这种情况通常是因为数据格式问题：
- **有效格式**: `快递单号:快递单号:YT7559422946509,中文` - 系统会正确提取
- **无效格式**: `快递单号:快递单号:快递单号:快递单号:...` - 系统会跳过这种重复前缀的格式
- 系统会自动识别并只处理有效的快递单号格式

### Q: 可以批量处理多个文件吗？
A: 目前支持单个文件处理，如需批量处理可以多次使用此功能。

## 更新日志

- **v1.0.0** (2025-01-XX): 初始版本发布
  - 基础转换功能
  - 文件上传和下载
  - 数据预览功能 